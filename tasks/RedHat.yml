---
# File: tasks/Red Hat.yml - Red Hat tasks for Vault

- name: OS packages
  yum: "name={{ item }} state=present"
  with_items: "{{ vault_redhat_os_packages }}"
  tags: installation

- name: dnsmasq package
  yum: name=dnsmasq state=present
  when: "vault_dnsmasq == true"
  tags: installation

- name: Download vault
  become: no
  connection: local
  get_url: "url={{ vault_zip_url }} dest={{ role_path }}/files/{{ vault_centos_pkg }} sha256sum={{ vault_zip_sha256 }} timeout=74"
  run_once: true
  tags: installation

- name: Unarchive vault
  become: no
  connection: local
  unarchive: "src={{ role_path }}/files/{{ vault_centos_pkg }} dest={{ role_path }}/files/ creates={{ role_path }}/files/vault"
  run_once: true
  tags: installation

- name: Install vault
  copy: "src={{ role_path }}/files/vault dest=/usr/local/bin/ owner={{ vault_user }} group={{ vault_group }} mode=0755"
  tags: installation

- name: Cleanup
  become: no
  connection: local
  file: "dest={{ role_path }}/files/vault* state=absent"
  run_once: true
  tags: installation
